#!/usr/bin/env python

import sys,getopt,os

def usage():
    print """Usage:
    pyscript file.py
    """

try:
    opts, args = getopt.getopt(sys.argv[1:], "ho:", ["help","output="])
except getopt.GetoptError:
    # print help information and exit:
    usage()
    sys.exit(2)


globals={}
for o, a in opts:
    if o in ("-h", "--help"):
        usage()
        sys.exit()
    if o in ("-o","--output"):
        globals['output']=a
    
if len(args) != 1:
    usage()
    sys.exit(s)

# redirect stdout and stderr to file
# keep a copy
save_err = sys.stderr

# open the log file
logFile = "pyscript.log"
log = open(logFile,"w")
sys.stderr = log

# now see about importing the defaults from .pyscript/defaults.py
HOME = os.path.expandvars("$HOME")

# if $HOME/.pyscript directory exists, append this to the python path
# this is so that user defined libs can be imported
if os.path.isdir(HOME+'/.pyscript'):
    sys.path.append(HOME+'/.pyscript')

if os.path.isfile(HOME+'/.pyscript/defaults.py'):
    # try $HOME/.pyscript/defaults.py
    execfile(HOME+'/.pyscript/defaults.py',globals)
else:
    print "No defaults file found."
    print "You'll need to put any defaults into your script"

print "Executing script..."
# now run the script
execfile(args[0],globals)

# clean up a bit
log.close()
sys.stderr = save_err

print "Done!"


